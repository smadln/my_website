<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prairie Sunset VR</title>
    <style>
        body { margin: 0; overflow: hidden; }
    </style>
    <!-- Include Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <!-- Include OrbitControls for navigation -->
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
    <!-- Include VRButton for VR support (non-module version) -->
    <script src="https://threejs.org/examples/js/vr/VRButton.js"></script>
</head>
<body>
    <!-- Your custom script -->
    <script>
        // Scene
        var scene = new THREE.Scene();

        // Camera
        var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

        // Renderer
        var renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.xr.enabled = true; // Enable VR support
        document.body.appendChild( renderer.domElement );

        // Add VR Button
        document.body.appendChild( VRButton.createButton( renderer ) );

        // Controls
        var controls = new THREE.OrbitControls( camera, renderer.domElement );
        camera.position.set( 0, 1.6, 5 );
        controls.update();

        // Sky
        var vertexShader = `
            varying vec3 vWorldPosition;
            void main() {
                vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
                vWorldPosition = worldPosition.xyz;
                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
            }
        `;

        var fragmentShader = `
            uniform vec3 topColor;
            uniform vec3 bottomColor;
            uniform float offset;
            uniform float exponent;
            varying vec3 vWorldPosition;
            void main() {
                float h = normalize( vWorldPosition + offset ).y;
                float t = pow( max( h, 0.0 ), exponent );
                gl_FragColor = vec4( mix( bottomColor, topColor, t ), 1.0 );
            }
        `;

        var uniforms = {
            topColor: { value: new THREE.Color( 0xFFB347 ) }, // Light orange
            bottomColor: { value: new THREE.Color( 0xFFCC33 ) }, // Golden color
            offset: { value: 0 },
            exponent: { value: 0.6 }
        };

        var skyMaterial = new THREE.ShaderMaterial( {
            uniforms: uniforms,
            vertexShader: vertexShader,
            fragmentShader: fragmentShader,
            side: THREE.BackSide
        } );

        var skyGeometry = new THREE.SphereGeometry( 500, 32, 15 );
        var sky = new THREE.Mesh( skyGeometry, skyMaterial );
        scene.add( sky );

        // Ground
        var groundGeometry = new THREE.PlaneGeometry( 1000, 1000 );
        var groundMaterial = new THREE.MeshLambertMaterial( { color: 0xCCBB88 } ); // Wheat-like color
        var ground = new THREE.Mesh( groundGeometry, groundMaterial );
        ground.rotation.x = - Math.PI / 2;
        scene.add( ground );

        // Lighting
        var ambientLight = new THREE.AmbientLight( 0x666666 );
        scene.add( ambientLight );

        var sunLight = new THREE.DirectionalLight( 0xFFDDCC, 1 );
        sunLight.position.set( -100, 100, -100 );
        scene.add( sunLight );

        // Grass Blades
        var grassBladeGeometry = new THREE.PlaneGeometry( 0.1, 1, 1, 4 );
        var positions = grassBladeGeometry.attributes.position.array;
        for ( var i = 0; i < positions.length; i += 3 ) {
            var y = positions[i + 1];
            var sway = Math.sin( y * Math.PI ) * 0.05 * Math.random();
            positions[i] += sway;
        }
        grassBladeGeometry.translate( 0, 0.5, 0 );
        var grassMaterial = new THREE.MeshLambertMaterial( { color: 0xA0D080, side: THREE.DoubleSide } );

        var grassCount = 10000;
        var grassMesh = new THREE.InstancedMesh( grassBladeGeometry, grassMaterial, grassCount );

        var dummy = new THREE.Object3D();

        for ( var i = 0; i < grassCount; i++ ) {
            var bladeHeight = 0.5 + Math.random() * 1.5;
            dummy.scale.set( 1, bladeHeight, 1 );
            dummy.position.set(
                ( Math.random() - 0.5 ) * 500,
                0,
                ( Math.random() - 0.5 ) * 500
            );
            dummy.rotation.y = Math.random() * Math.PI;
            dummy.updateMatrix();
            grassMesh.setMatrixAt( i, dummy.matrix );
        }

        scene.add( grassMesh );

        // Animation Loop
        function animate() {
            renderer.setAnimationLoop( render );
        }

        function render() {
            controls.update();
            renderer.render( scene, camera );
        }

        animate();

        // Handle Window Resize
        window.addEventListener( 'resize', onWindowResize, false );

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize( window.innerWidth, window.innerHeight );
        }
    </script>
</body>
</html>